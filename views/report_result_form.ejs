        <!DOCTYPE html>
        <html lang="vi">
        <head>
          <meta charset="UTF-8" />
          <title>K·∫øt qu·∫£ b√°o c√°o - <%= reportName %></title>
          <style>
            body { font-family: Arial, sans-serif; margin: 20px; }
            h2 { margin-bottom: 15px; }
            table { border-collapse: collapse; width: 100%; margin-top: 15px; }
            th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
            th { background: #f2f2f2; }
            tr:nth-child(even) { background: #fafafa; }
            .stats { margin-top: 30px; }
            .stats h3 { margin-bottom: 8px; }
            .copy-btn {
              margin-left: 10px;
              padding: 4px 8px;
              font-size: 12px;
              cursor: pointer;
              border: 1px solid #007bff;
              background: #007bff;
              color: #fff;
              border-radius: 4px;
            }
            .copy-btn:hover { background: #0056b3; }
            pre { background: #f9f9f9; padding: 10px; border: 1px solid #ddd; }
          </style>
        </head>
        <body>
          <h2>üìä K·∫øt qu·∫£ b√°o c√°o: <%= reportName %></h2>

          <!-- B·∫£ng ch√≠nh: hi·ªÉn th·ªã b·∫£n m·ªõi nh·∫•t c·ªßa t·ª´ng ƒë∆°n v·ªã -->
          <table>
            <thead>
              <tr>
                <th>ƒê∆°n v·ªã</th>
                <% fields.forEach(field => { %>
                  <th><%= field %></th>
                <% }) %>
                <th>Th·ªùi gian n·ªôp</th>
              </tr>
            </thead>
            <tbody>
              <% units.forEach(unit => { 
                   const sub = latest && latest[unit]; %>
                <tr>
                  <td><%= unit %></td>
                  <% fields.forEach(field => { %>
                    <td><%= sub && sub.data && sub.data[field] ? sub.data[field] : "" %></td>
                  <% }) %>
                  <td><%= sub && sub.submittedAt ? new Date(sub.submittedAt).toLocaleString("vi-VN") : "" %></td>
                </tr>
              <% }) %>
            </tbody>
          </table>

          <!-- B·∫£ng ph·ª•: c√°c b·∫£n ghi tr∆∞·ªõc ƒë√≥ (ch·ªâ hi·ªÉn th·ªã n·∫øu c√≥ l·ªãch s·ª≠) -->
          <% if (history && Object.keys(history).length > 0) { %>
            <h3>üìú B·∫£ng ph·ª•: C√°c b·∫£n ghi tr∆∞·ªõc ƒë√≥</h3>
            <table>
              <thead>
                <tr>
                  <th>ƒê∆°n v·ªã</th>
                  <% fields.forEach(field => { %>
                    <th><%= field %></th>
                  <% }) %>
                  <th>Th·ªùi gian n·ªôp</th>
                </tr>
              </thead>
              <tbody>
                <% for (const unit in history) {
                     const arr = history[unit] || [];
                     arr.forEach(sub => { %>
                  <tr>
                    <td><%= unit %></td>
                    <% fields.forEach(field => { %>
                      <td><%= sub && sub.data && sub.data[field] ? sub.data[field] : "" %></td>
                    <% }) %>
                    <td><%= sub && sub.submittedAt ? new Date(sub.submittedAt).toLocaleString("vi-VN") : "" %></td>
                  </tr>
                <% }) } %>
              </tbody>
            </table>
          <% } %>

          <!-- Th·ªëng k√™ -->
          <div class="stats">
            <% 
              const submittedUnits = units.filter(u => latest && latest[u]);
              const notSubmittedUnits = units.filter(u => !(latest && latest[u]));
            %>

            <h3>‚úÖ ƒê∆°n v·ªã ƒë√£ n·ªôp (<%= submittedUnits.length %>): 
              <button class="copy-btn" onclick="copyText('submittedList')">Copy</button>
            </h3>
            <pre id="submittedList"><%= submittedUnits.join(", ") %></pre>

            <h3>‚ùå ƒê∆°n v·ªã ch∆∞a n·ªôp (<%= notSubmittedUnits.length %>): 
              <button class="copy-btn" onclick="copyText('notSubmittedList')">Copy</button>
            </h3>
            <pre id="notSubmittedList"><%= notSubmittedUnits.join(", ") %></pre>
          </div>

          <script>
            function copyText(elementId) {
              const text = document.getElementById(elementId).innerText;
              navigator.clipboard.writeText(text).then(() => {
                alert("ƒê√£ copy v√†o clipboard!");
              });
            }
          </script>
        </body>
        </html>
